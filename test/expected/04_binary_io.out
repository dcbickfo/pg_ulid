-- ULID binary I/O tests
-- Tests COPY with binary format (ulid_send and ulid_recv functions)
SET client_min_messages = error;
\set ECHO none
ERROR:  extension "pg_ulid" already exists
-- Create source table
CREATE TABLE ulids_src (
    ulid_test1 ulid,
    ulid_test2 ulid
);
-- Insert test data
INSERT INTO ulids_src (ulid_test1, ulid_test2)
VALUES
    ('01H00000000000000000000000', '01H00000000000000000000000'),
    ('02000000000000000000000000', '02000000000000000000000000'),
    ('07000000000000000000000000', '07000000000000000000000000'),
    ('01HN64YSHF6P620FAY6YAJHQRK', '01HN64YSHFVRED3MZ41CFA2B91'),
    ('01HN64YSHFEB58ZAH8AV4HTTBT', '01HN64YSHF5R3F07A8440PMDZR'),
    ('01HN64YSHFFA1RXFMZ9R1W8SBV', '01HN64YSHF2S74QQNCDAD15C0S'),
    ('01HN64YSHF8QPCNP0FE4VNK6J7', '01HN64YSHFMZKAF6RBQVP97YN0'),
    ('01HN64YSHFZQXPJWNGGG2455V3', '01HN64YSHF7VGB658863XBS216');
-- Create destination table
CREATE TABLE ulids_dest (
    ulid_test1 ulid,
    ulid_test2 ulid
);
-- Test binary COPY TO/FROM
COPY ulids_src TO '/tmp/ulids_binary' WITH (FORMAT binary);
COPY ulids_dest FROM '/tmp/ulids_binary' WITH (FORMAT binary);
-- Verify data integrity after binary copy
SELECT * FROM ulids_src ORDER BY ulid_test1;
         ulid_test1         |         ulid_test2         
----------------------------+----------------------------
 01H00000000000000000000000 | 01H00000000000000000000000
 01HN64YSHF6P620FAY6YAJHQRK | 01HN64YSHFVRED3MZ41CFA2B91
 01HN64YSHF8QPCNP0FE4VNK6J7 | 01HN64YSHFMZKAF6RBQVP97YN0
 01HN64YSHFEB58ZAH8AV4HTTBT | 01HN64YSHF5R3F07A8440PMDZR
 01HN64YSHFFA1RXFMZ9R1W8SBV | 01HN64YSHF2S74QQNCDAD15C0S
 01HN64YSHFZQXPJWNGGG2455V3 | 01HN64YSHF7VGB658863XBS216
 02000000000000000000000000 | 02000000000000000000000000
 07000000000000000000000000 | 07000000000000000000000000
(8 rows)

SELECT * FROM ulids_dest ORDER BY ulid_test1;
         ulid_test1         |         ulid_test2         
----------------------------+----------------------------
 01H00000000000000000000000 | 01H00000000000000000000000
 01HN64YSHF6P620FAY6YAJHQRK | 01HN64YSHFVRED3MZ41CFA2B91
 01HN64YSHF8QPCNP0FE4VNK6J7 | 01HN64YSHFMZKAF6RBQVP97YN0
 01HN64YSHFEB58ZAH8AV4HTTBT | 01HN64YSHF5R3F07A8440PMDZR
 01HN64YSHFFA1RXFMZ9R1W8SBV | 01HN64YSHF2S74QQNCDAD15C0S
 01HN64YSHFZQXPJWNGGG2455V3 | 01HN64YSHF7VGB658863XBS216
 02000000000000000000000000 | 02000000000000000000000000
 07000000000000000000000000 | 07000000000000000000000000
(8 rows)

-- Verify counts match
SELECT COUNT(*) AS src_count FROM ulids_src;
 src_count 
-----------
         8
(1 row)

SELECT COUNT(*) AS dest_count FROM ulids_dest;
 dest_count 
------------
          8
(1 row)

-- Cleanup
DROP TABLE ulids_src;
DROP TABLE ulids_dest;
